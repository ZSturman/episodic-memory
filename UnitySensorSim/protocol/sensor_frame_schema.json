{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "sensor_frame.schema.json",
  "title": "SensorFrame",
  "description": "A single sensor frame streamed from a client to the Python backend containing world state snapshot. This schema is client-agnostic.",
  "type": "object",
  "required": ["protocol_version", "frame_id", "timestamp"],
  "properties": {
    "protocol_version": {
      "type": "string",
      "description": "Protocol version for backward compatibility",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "frame_id": {
      "type": "integer",
      "description": "Monotonically increasing frame identifier",
      "minimum": 0
    },
    "timestamp": {
      "type": ["string", "number"],
      "description": "Timestamp: ISO 8601 string or Unix timestamp in seconds"
    },
    "camera": {
      "$ref": "#/definitions/Camera",
      "description": "Camera/player pose data"
    },
    "current_room_guid": {
      "type": ["string", "null"],
      "description": "GUID of the room the player is currently in, or empty/null if not in any room"
    },
    "entities": {
      "type": "array",
      "description": "List of all tracked entities in the world",
      "items": {
        "$ref": "#/definitions/EntityData"
      }
    },
    "state_changes": {
      "type": "array",
      "description": "List of state changes since last frame",
      "items": {
        "$ref": "#/definitions/StateChangeEvent"
      }
    }
  },
  "definitions": {
    "Camera": {
      "type": "object",
      "description": "Camera position and orientation",
      "required": ["position", "forward"],
      "properties": {
        "position": {
          "$ref": "#/definitions/Vector3",
          "description": "Camera world position"
        },
        "forward": {
          "$ref": "#/definitions/Vector3",
          "description": "Forward direction unit vector"
        },
        "up": {
          "$ref": "#/definitions/Vector3",
          "description": "Up direction unit vector"
        },
        "yaw": {
          "type": "number",
          "description": "Horizontal rotation in degrees"
        },
        "pitch": {
          "type": "number",
          "description": "Vertical rotation in degrees (-180..180)"
        }
      }
    },
    "Vector3": {
      "type": "object",
      "description": "3D vector or point",
      "required": ["x", "y", "z"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    },
    "EntityData": {
      "type": "object",
      "description": "Data for a single tracked entity. Labels and categories are owned by the backend, not the client.",
      "required": ["guid", "position"],
      "properties": {
        "guid": {
          "type": "string",
          "description": "Stable unique identifier for this entity"
        },
        "position": {
          "$ref": "#/definitions/Vector3",
          "description": "Entity position (world or agent-relative depending on implementation)"
        },
        "size": {
          "$ref": "#/definitions/Vector3",
          "description": "Approximate bounding box size"
        },
        "distance": {
          "type": "number",
          "description": "Distance from camera in units"
        },
        "is_visible": {
          "type": "boolean",
          "description": "Whether entity is visible from the camera"
        },
        "interactable_type": {
          "type": ["string", "null"],
          "description": "Interactable type: null, 'toggle', 'moveable'"
        },
        "interactable_state": {
          "type": ["string", "null"],
          "description": "Current state for interactables (e.g., 'open', 'closed', 'on', 'off')"
        }
      }
    },
    "StateChangeEvent": {
      "type": "object",
      "description": "A state change that occurred since the last frame",
      "required": ["entity_guid", "change_type", "old_value", "new_value", "timestamp"],
      "properties": {
        "entity_guid": {
          "type": "string",
          "description": "GUID of the entity that changed, or 'player' for player events"
        },
        "change_type": {
          "type": "string",
          "description": "Type of change",
          "enum": ["state_changed", "room_changed", "spawned", "despawned", "moved"]
        },
        "old_value": {
          "type": "string",
          "description": "Previous value"
        },
        "new_value": {
          "type": "string",
          "description": "New value"
        },
        "timestamp": {
          "type": ["string", "number"],
          "description": "When the change occurred (ISO 8601 or Unix timestamp)"
        }
      }
    }
  }
}
